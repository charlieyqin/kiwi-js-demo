<html>
<body>
<script src="kiwi.js"></script>
<script type="text/javascript">

var game = new Kiwi.Game();
var state = new Kiwi.State('state');

state.preload = function(){
  Kiwi.State.prototype.preload.call(this);

  this.addSpriteSheet('angry-imp', 'character.png', 64, 64);
}

state.create = function(){
  Kiwi.State.prototype.create.call(this);

  this.character = new Kiwi.GameObjects.Sprite(this, this.textures['angry-imp'], 50, 50);

  this.character.animation.add('idle-left', [4], 0.1, false);
  this.character.animation.add('idle-right', [12], 0.1, false);
  this.character.animation.add('idle-up', [0], 0.1, false);
  this.character.animation.add('idle-down', [8], 0.1, false);

  this.character.animation.add('move-left', [4, 5, 6, 7], 0.1, true);
  this.character.animation.add('move-right', [12, 13, 14, 15], 0.1, true);
  this.character.animation.add('move-up', [0, 1, 2, 3], 0.1, true);
  this.character.animation.add('move-down', [8, 9, 10, 11], 0.1, true);

  this.character.animation.add('attack-up', [16, 17, 18, 19], 0.1, false);
  this.character.animation.add('attack-left', [20, 21, 22, 23], 0.1, false);
  this.character.animation.add('attack-down', [24, 25, 26, 27], 0.1, false);
  this.character.animation.add('attack-right', [28, 29, 30, 31], 0.1, false);

  this.character.facing = 'right';
  this.character.animation.play('idle-right');
  this.addChild(this.character);

  this.leftKey = this.game.input.keyboard.addKey(Kiwi.Input.Keycodes.LEFT);
  this.rightKey = this.game.input.keyboard.addKey(Kiwi.Input.Keycodes.RIGHT);
  this.upKey = this.game.input.keyboard.addKey(Kiwi.Input.Keycodes.UP);
  this.downKey = this.game.input.keyboard.addKey(Kiwi.Input.Keycodes.DOWN);
  this.space = this.game.input.keyboard.addKey(Kiwi.Input.Keycodes.SPACEBAR);
}

state.update = function(){
  Kiwi.State.prototype.update.call(this);

  if (this.space.isDown) {
    this.character.animation.play('attack-' + this.character.facing);
  }
  else if (this.downKey.isDown || this.upKey.isDown || this.leftKey.isDown || this.rightKey.isDown) {
    if (this.downKey.isDown) {
      this.character.facing = 'down';
      if (this.character.transform.y < 536) this.character.transform.y += 3;
    }
    else if (this.upKey.isDown) {
      this.character.facing = 'up';
      if (this.character.transform.y > 3) this.character.transform.y -= 3;
    }
    else if (this.leftKey.isDown) {
      this.character.facing = 'left';
      if (this.character.transform.x > 3) this.character.transform.x -= 3;
    }
    else if (this.rightKey.isDown) {
      this.character.facing = 'right';
      if (this.character.transform.x < 736) this.character.transform.x += 3;
    }

    if (this.character.animation.currentAnimation.name != 'move-' + this.character.facing)
      this.character.animation.play('move-' + this.character.facing);
  }
  else if (this.character.animation.currentAnimation.name.indexOf('attack') != 0) {
    this.character.animation.play('idle' + this.character.facing);
  }
};

game.states.addState(state, true);

</script>
<style>
body { background: black;}
body > div { margin: auto;}
</style>
</body>
</html>
